export async function ensureFile(token){const h={'Authorization':`Bearer ${token}`};let fid=null;let r=await fetch('https://www.googleapis.com/drive/v3/files?q=name=%27GCalTasker.json%27', {headers:h});let j=await r.json();if(j.files&&j.files.length) fid=j.files[0].id; else {let r2=await fetch('https://www.googleapis.com/drive/v3/files?uploadType=multipart',{method:'POST',headers:{...h},body:`--x\nContent-Type: application/json; charset=UTF-8\n\n{"name":"GCalTasker.json","mimeType":"application/json"}\n--x\nContent-Type: application/json\n\n{"tasks":[]}\n--x--`});let j2=await r2.json();fid=j2.id;}return fid;} 

export async function readTasks(token, fid){let r=await fetch(`https://www.googleapis.com/drive/v3/files/${fid}?alt=media`,{headers:{'Authorization':`Bearer ${token}`}});return r.json();}
export async function saveTasks(token,fid,data){await fetch(`https://www.googleapis.com/upload/drive/v3/files/${fid}?uploadType=media`,{method:'PATCH',headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'},body:JSON.stringify(data)});}